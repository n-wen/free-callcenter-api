# 003-分机管理 Develop Task

**状态**: Done

---

**要实现的功能**
实现分机的配置管理、状态监控、自主呼出呼入功能

**技术栈**
- 框架: Spring Boot 3.x
- 数据库: PostgreSQL
- API: RESTful
- 通信: FreeSWITCH ESL

**相关文档**
- [FreeSWITCH mod_xml_curl 配置说明](../ref/freeswitch/README.md)

---

## 子任务

- [x] 实现分机 CRUD API
  - 创建分机
    - 在数据库中创建分机记录
    - 实现 FreeSWITCH mod_xml_curl 动态分机接口
      - 接口路径：POST /fs/directory
      - 接收请求参数：user（分机号）、domain（域名）、action（请求类型）
      - 根据分机号查询数据库，返回 XML 格式配置
      - XML 结构：document → section[directory] → domain → user[id]
    - 返回 XML 格式的分机配置（params + variables）
  - 查询分机列表
  - 更新分机配置
  - 删除分机

- [ ] 实现分机状态监控
  - 监听 FreeSWITCH 注册事件
  - 实时更新分机状态
  - 提供分机状态查询接口

- [ ] 编写分机管理测试用例
  测试: mvn test -Dtest=ExtensionControllerTest

---

## 任务目标

- [x] API: POST /api/extensions - 创建分机成功
- [x] API: GET /api/extensions - 查询分机列表成功
- [ ] API: PUT /api/extensions/{id} - 更新分机成功
- [ ] API: DELETE /api/extensions/{id} - 删除分机成功
- [ ] API: GET /api/extensions/{id}/status - 查询分机状态成功
- [ ] API: POST /api/extensions/{id}/dial - 分机发起外呼成功
- [ ] 分机能正常呼入呼出

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
