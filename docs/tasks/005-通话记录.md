# 005-通话记录 Develop Task

**状态**: Draft

---

**要实现的功能**
实现通话记录(CDR)管理，记录每次通话的详细信息，支持查询和统计

**技术栈**
- 框架: Spring Boot 3.x
- 数据库: PostgreSQL
- 通信: FreeSWITCH ESL

---

## 子任务

- [ ] 设计通话记录数据模型
  - 主叫号码、被叫号码
  - 开始时间、结束时间
  - 通话时长、状态
  - 分机信息
  - 录音文件路径

- [ ] 实现通话事件监听
  - 监听 CHANNEL_CREATE 事件
  - 监听 CHANNEL_ANSWER 事件
  - 监听 CHANNEL_HANGUP 事件
  - 自动创建和更新通话记录

- [ ] 实现通话记录查询 API
  - 查询通话记录列表（支持分页、筛选）
  - 查询单条通话记录详情
  - 按时间范围查询
  - 按分机查询

- [ ] 实现通话统计接口
  - 按日/周/月统计通话量
  - 统计分机通话时长
  - 统计接通率

- [ ] 实现通话录音管理（可选）
  - 录音文件上传
  - 录音文件查询
  - 录音播放接口

- [ ] 编写通话记录测试用例
  测试: mvn test -Dtest=CallRecordControllerTest

---

## 任务目标

- [ ] 每次通话自动创建 CDR 记录
- [ ] API: GET /api/call-records - 查询通话记录列表成功
- [ ] API: GET /api/call-records/{id} - 查询通话详情成功
- [ ] API: GET /api/call-records/stats - 统计接口返回正确数据
- [ ] 通话记录字段完整、准确

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
